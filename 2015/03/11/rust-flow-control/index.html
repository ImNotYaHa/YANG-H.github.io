<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<title>
  
    Rust - 控制流
  
</title>

<meta name="description" content="原文在此编写控制流，如if/else,for等是任何编程语言的必备部分。下面介绍 Rust 中的用法。
7.1 if/else编写if-else分支与其它语言类似。Rust 中稍特别的地方是布尔条件不需要包在括号里，且每个条件后面必须跟一个 block。if-else语句都是表达式，且每个分支返回值类型必须相同。">
<meta property="og:type" content="article">
<meta property="og:title" content="Rust - 控制流">
<meta property="og:url" content="http://howyoung.info/2015/03/11/rust-flow-control/index.html">
<meta property="og:site_name" content="How Young?">
<meta property="og:description" content="原文在此编写控制流，如if/else,for等是任何编程语言的必备部分。下面介绍 Rust 中的用法。
7.1 if/else编写if-else分支与其它语言类似。Rust 中稍特别的地方是布尔条件不需要包在括号里，且每个条件后面必须跟一个 block。if-else语句都是表达式，且每个分支返回值类型必须相同。">
<meta property="og:updated_time" content="2016-03-12T16:38:06.291Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Rust - 控制流">
<meta name="twitter:description" content="原文在此编写控制流，如if/else,for等是任何编程语言的必备部分。下面介绍 Rust 中的用法。
7.1 if/else编写if-else分支与其它语言类似。Rust 中稍特别的地方是布尔条件不需要包在括号里，且每个条件后面必须跟一个 block。if-else语句都是表达式，且每个分支返回值类型必须相同。">


  <link rel="alternative" href="/atom.xml" title="How Young?" type="application/atom+xml">



  <link rel="icon" href="/favicon.png">


<link rel="stylesheet" href="/styles/main.css">






</head>
<body
  
    class="monochrome"
  
  >
  <div class="mobile-header">
  <button class="sidebar-toggle" type="button">
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
  </button>
  <a class="title" href="/">How Young?</a>
</div>

  <div class="main-container">
    <div class="sidebar">
  <div class="header">
    <h1 class="title"><a href="/">How Young?</a></h1>
    
      <p class="subtitle">
        Always Young Enough to Pursue My Dream :)
      </p>
    
    <div class="info">
      <div class="content">
        
          <div class="description">A Researcher</div>
        
        
          <div class="author">Hao Yang (杨昊)</div>
        
        
          <div class="email">
             <a href="http://scr.im/howyoung">y...@gmail.com</a>
          </div>
        
        
          <div class="email">
             <a href="https://www.linkedin.com/in/hao-yang-b1110532">LinkedIn</a>
          </div>
        
      </div>
      
        <div class="avatar">
          
            <a href="/about"><img src="/images/loong_circ_small.png"></a>
          
        </div>
      
    </div>
  </div>
  <div class="body">
    
      
        <ul class="nav">
          
            
              <li class="category-list-container">
                <a href="javascript:;">Category</a>
                <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/tech/">技术</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/essay/">随感</a><span class="category-list-count">1</span></li></ul>
              </li>
            
          
            
              <li class="tag-list-container">
                <a href="javascript:;">Tag</a>
                <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Blender/">Blender</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C++</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CMake/">CMake</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CVPR-2016/">CVPR 2016</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Photoshop/">Photoshop</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Rust/">Rust</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Wheels/">Wheels</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/学习-Rust/">学习 Rust</a><span class="tag-list-count">15</span></li></ul>
              </li>
            
          
            
              <li class="archive-list-container">
                <a href="javascript:;">Archive</a>
                <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/">2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/">2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/">2014</a><span class="archive-list-count">3</span></li></ul>
              </li>
            
          
        </ul>
      
    
  </div>
</div>

    <div class="main-content">
      
        <div style="max-width: 1000px">
      
          <article id="post-rust-flow-control" class="article article-type-post">
  
    <h1 class="article-header">
      Rust - 控制流
    </h1>
  
  

  <div class="article-info">
    <span class="article-date">
  Mar 11 2015
</span>

    
	<span class="article-category tagcloud">
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/tech/">技术</a></li></ul>
	</span>


    
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rust/">Rust</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/学习-Rust/">学习 Rust</a></li></ul>
	</span>


  </div>
  <div class="article-entry">
    <h2 id="原文在此"><a href="#原文在此" class="headerlink" title="原文在此"></a><a href="http://rustbyexample.com/flow_control.html" target="_blank" rel="external">原文在此</a></h2><p>编写控制流，如<code>if</code>/<code>else</code>,<code>for</code>等是任何编程语言的必备部分。下面介绍 Rust 中的用法。</p>
<h2 id="7-1-if-else"><a href="#7-1-if-else" class="headerlink" title="7.1 if/else"></a>7.1 if/else</h2><p>编写<code>if</code>-<code>else</code>分支与其它语言类似。Rust 中稍特别的地方是布尔条件不需要包在括号里，且每个条件后面必须跟一个 block。<code>if</code>-<code>else</code>语句都是表达式，且每个分支返回值类型必须相同。</p>
<a id="more"></a>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> n = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">print!</span>(<span class="string">"&#123;&#125; is negative"</span>, n);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> n &gt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">print!</span>(<span class="string">"&#123;&#125; is positive"</span>, n);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print!</span>(<span class="string">"&#123;&#125; is zero"</span>, n);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> big_n =</span><br><span class="line">        <span class="keyword">if</span> n &lt; <span class="number">10</span> &amp;&amp; n &gt; -<span class="number">10</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">", and is a small number, increase ten-fold"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 该表达式的返回类型是 `i32`</span></span><br><span class="line">            <span class="number">10</span> * n</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">", and is a big number, reduce by two"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 该表达式的返回类型也是 `i32`</span></span><br><span class="line">            n / <span class="number">2</span></span><br><span class="line">            <span class="comment">// TODO ^ 尝试使用分号来阻断返回类型</span></span><br><span class="line">        &#125;;</span><br><span class="line">    <span class="comment">//   ^ 别忘了加分号! 所有 `let` 绑定都需要分号结尾</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"&#123;&#125; -&gt; &#123;&#125;"</span>, n, big_n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="7-2-loop"><a href="#7-2-loop" class="headerlink" title="7.2 loop"></a>7.2 loop</h2><p>Rust 提供了<code>loop</code>关键字来建立无限循环。</p>
<p><code>break</code>语句可以用来退出循环，而<code>continue</code>语句则用来跳过本次迭代中的剩余部分，直接开始新的循环。<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> count = <span class="number">0u32</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"Let's count until infinity!"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 无限循环</span></span><br><span class="line">    <span class="keyword">loop</span> &#123;</span><br><span class="line">        count += <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> count == <span class="number">3</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">"three"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 跳过本轮剩余部分</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, count);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> count == <span class="number">5</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">"OK, that's enough"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 退出循环</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="7-2-1-嵌套与标签"><a href="#7-2-1-嵌套与标签" class="headerlink" title="7.2.1 嵌套与标签"></a>7.2.1 嵌套与标签</h3><p>在嵌套的循环中可以<code>break</code>或<code>continue</code>到外层循环中。这要求循环必须使用<code>&#39;label</code>语法进行标注，然后将标签名传给<code>break</code>/<code>continue</code>语句即可。<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="symbol">'outer</span>: <span class="keyword">loop</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"Entered the outer loop"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="symbol">'inner</span>: <span class="keyword">loop</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">"Entered the inner loop"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 这只会退出 'inner 循环</span></span><br><span class="line">            <span class="comment">//break;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 这将退出 'outer 循环</span></span><br><span class="line">            <span class="keyword">break</span> <span class="symbol">'outer</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"This point will never be reached"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"Exited the outer loop"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="7-3-while"><a href="#7-3-while" class="headerlink" title="7.3 while"></a>7.3 while</h2><p><code>while</code>关键字可以创建一个只要某个条件满足就永远不终止的循环。下面是用<code>while</code>循环写的一个 <a href="http://en.wikipedia.org/wiki/Fizz_buzz" target="_blank" rel="external">FizzBuzz</a>：<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="comment">// 计数器</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> n = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 只要 `n` 小于 101 就继续循环</span></span><br><span class="line">    <span class="keyword">while</span> n &lt; <span class="number">101</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> n % <span class="number">15</span> == <span class="number">0</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">"fizzbuzz"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> n % <span class="number">3</span> == <span class="number">0</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">"fizz"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> n % <span class="number">5</span> == <span class="number">0</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">"buzz"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, n);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 计数器加一</span></span><br><span class="line">        n += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="7-4-for-与区间"><a href="#7-4-for-与区间" class="headerlink" title="7.4 for 与区间"></a>7.4 for 与区间</h2><p><code>for in</code>语句可以被用来遍历一个<code>Iterator</code>（迭代器），迭代器能够生成多个值。最简单的构造迭代器的方法是使用区间标识：<code>a..b</code>能够生成所有间隔为 1 的 [<code>a</code>,<code>b</code>) 区间内的值。</p>
<p>我们可以用<code>for</code>循环重写 FizzBuzz。<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="comment">// 在每次迭代中，`n` 将分别取值: 1, 2, ..., 100</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> <span class="number">1</span>..<span class="number">101</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> n % <span class="number">15</span> == <span class="number">0</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">"fizzbuzz"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> n % <span class="number">3</span> == <span class="number">0</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">"fizz"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> n % <span class="number">5</span> == <span class="number">0</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">"buzz"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, n);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="7-5-match"><a href="#7-5-match" class="headerlink" title="7.5 match"></a>7.5 match</h2><p>Rust 通过<code>match</code>关键字来进行模式匹配，这类似于 C 中的<code>switch</code>。<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> number = <span class="number">13</span>;</span><br><span class="line">    <span class="comment">// TODO ^ 尝试给 `number` 赋不同的值</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"Tell me about &#123;&#125;"</span>, number);</span><br><span class="line">    <span class="keyword">match</span> number &#123;</span><br><span class="line">        <span class="comment">// 匹配单个值</span></span><br><span class="line">        <span class="number">1</span> =&gt; <span class="built_in">println!</span>(<span class="string">"One!"</span>),</span><br><span class="line">        <span class="comment">// 匹配多个值</span></span><br><span class="line">        <span class="number">2</span> | <span class="number">3</span> | <span class="number">5</span> | <span class="number">7</span> | <span class="number">11</span> =&gt; <span class="built_in">println!</span>(<span class="string">"This is a prime"</span>),</span><br><span class="line">        <span class="comment">// 匹配一个闭区间</span></span><br><span class="line">        <span class="number">13</span>...<span class="number">19</span> =&gt; <span class="built_in">println!</span>(<span class="string">"A teen"</span>),</span><br><span class="line">        <span class="comment">// 其它情况</span></span><br><span class="line">        _ =&gt; <span class="built_in">println!</span>(<span class="string">"Ain't special"</span>),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> boolean = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// match 同样也是一种表达式</span></span><br><span class="line">    <span class="keyword">let</span> binary = <span class="keyword">match</span> boolean &#123;</span><br><span class="line">        <span class="comment">// The arms of a match must cover all the possible values</span></span><br><span class="line">        <span class="literal">false</span> =&gt; <span class="number">0</span>,</span><br><span class="line">        <span class="literal">true</span> =&gt; <span class="number">1</span>,</span><br><span class="line">        <span class="comment">// TODO ^ 尝试注释掉其中一个分支</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"&#123;&#125; -&gt; &#123;&#125;"</span>, boolean, binary);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="7-5-1-解构"><a href="#7-5-1-解构" class="headerlink" title="7.5.1 解构"></a>7.5.1 解构</h3><p><code>match</code>语句块具有多种解构功能。</p>
<h4 id="7-5-1-1-tuples-元组"><a href="#7-5-1-1-tuples-元组" class="headerlink" title="7.5.1.1 tuples 元组"></a>7.5.1.1 tuples 元组</h4><p>tuple 元组在<code>match</code>中的解构方式如下：<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> pair = (<span class="number">0</span>, -<span class="number">2</span>);</span><br><span class="line">    <span class="comment">// TODO ^ 尝试给 `pair` 赋不同的元组值</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"Tell me about &#123;:?&#125;"</span>, pair);</span><br><span class="line">    <span class="comment">// match 可以解构一个 tuple</span></span><br><span class="line">    <span class="keyword">match</span> pair &#123;</span><br><span class="line">        <span class="comment">// 解构 `pair` 中的第二个元素</span></span><br><span class="line">        (<span class="number">0</span>, y) =&gt; <span class="built_in">println!</span>(<span class="string">"First is `0` and `y` is `&#123;:?&#125;`"</span>, y),</span><br><span class="line">        (x, <span class="number">0</span>) =&gt; <span class="built_in">println!</span>(<span class="string">"`x` is `&#123;:?&#125;` and last is `0`"</span>, x),</span><br><span class="line">        _      =&gt; <span class="built_in">println!</span>(<span class="string">"It doesn't matter what they are"</span>),</span><br><span class="line">        <span class="comment">// `_` 表示不将值绑定到变量</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>关于 tuple 详见 <a href="http://rustbyexample.com/tuples.html" target="_blank" rel="external">Tuples</a>。</p>
<h4 id="7-5-1-2-enums-枚举"><a href="#7-5-1-2-enums-枚举" class="headerlink" title="7.5.1.2 enums 枚举"></a>7.5.1.2 enums 枚举</h4><p>enum 解构方法类似：<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只有设置了 `derive(Debug)` `println!` 才能对此类型可用</span></span><br><span class="line"><span class="comment">// `allow(dead_code)` 可以禁用部分警告</span></span><br><span class="line"><span class="meta">#[allow(dead_code)]</span></span><br><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Color</span></span> &#123;</span><br><span class="line">    <span class="comment">// 这三种 Color 仅有名称</span></span><br><span class="line">    Red,</span><br><span class="line">    Blue,</span><br><span class="line">    Green,</span><br><span class="line">    <span class="comment">// 这种 Color 不但有名称，还是一个包含 3 个`i32`类型的 tuple</span></span><br><span class="line">    RGB(<span class="keyword">i32</span>, <span class="keyword">i32</span>, <span class="keyword">i32</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> color = Color::RGB(<span class="number">122</span>, <span class="number">17</span>, <span class="number">40</span>);</span><br><span class="line">    <span class="comment">// TODO ^ 尝试 `color` 的不同值</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"What color is it?"</span>);</span><br><span class="line">    <span class="comment">// `enum` 可以使用 `match` 加以解构.</span></span><br><span class="line">    <span class="keyword">match</span> color &#123;</span><br><span class="line">        Color::Red   =&gt; <span class="built_in">println!</span>(<span class="string">"The color is Red!"</span>),</span><br><span class="line">        Color::Blue  =&gt; <span class="built_in">println!</span>(<span class="string">"The color is Blue!"</span>),</span><br><span class="line">        Color::Green =&gt; <span class="built_in">println!</span>(<span class="string">"The color is Green!"</span>),</span><br><span class="line">        Color::RGB(r, g, b) =&gt; &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">"Red: &#123;:?&#125;, green: &#123;:?&#125;, and blue: &#123;:?&#125;!:"</span>, r, g, b);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 不需要其它分支，因为已经考虑了所有可能情况</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>详见 <a href="http://rustbyexample.com/fn/unused.html" target="_blank" rel="external">#[allow(…)]</a>，<a href="http://rustbyexample.com/enum.html" target="_blank" rel="external">enum</a> 和 <a href="http://rustbyexample.com/trait/derive.html" target="_blank" rel="external">#[derive(…)]</a>。</p>
<h4 id="7-5-1-3-指针-引用"><a href="#7-5-1-3-指针-引用" class="headerlink" title="7.5.1.3 指针/引用"></a>7.5.1.3 指针/引用</h4><p>Rust 中指针与引用的概念和用法与类 C 语言不同。详见 <a href="https://doc.rust-lang.org/book/pointers.html" target="_blank" rel="external">Pointers</a>。</p>
<ul>
<li>使用<code>*</code>进行解引用</li>
<li>使用<code>&amp;</code>,<code>ref</code>和<code>ref mut</code>来进行解构</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="comment">// 指定一个类型为 `i32` 的引用. </span></span><br><span class="line">    <span class="comment">// `&amp;` 表示将 4 转换成一个引用（属于一种 Rust 指针）.</span></span><br><span class="line">    <span class="keyword">let</span> reference = &amp;<span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">match</span> reference &#123;</span><br><span class="line">        <span class="comment">// 若将 `reference` 与 `&amp;val` 匹配, 那么匹配的两边分别是：</span></span><br><span class="line">        <span class="comment">// `&amp;i32`</span></span><br><span class="line">        <span class="comment">// `&amp;val`</span></span><br><span class="line">        <span class="comment">//  ^ 我们可以看到若消去共有的 `&amp;` 符号, 那么 `i32` 类型的值</span></span><br><span class="line">        <span class="comment">// （而非引用）应该被赋给 `val`.</span></span><br><span class="line">        <span class="comment">// 这就是使用 `&amp;` 进行解构的原理</span></span><br><span class="line">        &amp;val =&gt; <span class="built_in">println!</span>(<span class="string">"Got a value via destructuring: &#123;:?&#125;"</span>, val),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 你可以在匹配之前就使用 `*` 对输入对象解引用，</span></span><br><span class="line">    <span class="comment">// 从而避免再在赋值对象前写 `&amp;`.</span></span><br><span class="line">    <span class="keyword">match</span> *reference &#123;</span><br><span class="line">        val =&gt; <span class="built_in">println!</span>(<span class="string">"Got a value via dereferencing: &#123;:?&#125;"</span>, val),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 前面 `reference` 变量是一个 `&amp;` 引用，</span></span><br><span class="line">    <span class="comment">// 这是因为它的赋值语句右边给的是个引用. </span></span><br><span class="line">    <span class="comment">// 这个变量则不是引用，因为右边不是</span></span><br><span class="line">    <span class="keyword">let</span> _not_a_reference = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为此 Rust 提供了 `ref` 关键字来处理希望将值赋给引用的情况. </span></span><br><span class="line">    <span class="comment">// 通过在赋值语句中的被赋值对象前加 `ref`，</span></span><br><span class="line">    <span class="comment">// 可以构造一个引用，并将其绑定到一个值上; </span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">ref</span> _is_a_reference = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 同理，定义两个非引用类型的值，</span></span><br><span class="line">    <span class="comment">// 然后可以分别通过 `ref` 和 `mut ref` 来构造绑定在这些值上的引用。</span></span><br><span class="line">    <span class="keyword">let</span> value = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> mut_value = <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用 `ref` 关键字来构造一个不可变引用</span></span><br><span class="line">    <span class="keyword">match</span> value &#123;</span><br><span class="line">        <span class="keyword">ref</span> r =&gt; <span class="built_in">println!</span>(<span class="string">"Got a reference to a value: &#123;:?&#125;"</span>, r),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 同理使用 `ref mut` 构造一个可变引用.</span></span><br><span class="line">    <span class="keyword">match</span> mut_value &#123;</span><br><span class="line">        <span class="keyword">ref</span> <span class="keyword">mut</span> m =&gt; &#123;</span><br><span class="line">            <span class="comment">// 得到了一个引用. 对其内容进行操作之前别忘了先解引用.</span></span><br><span class="line">            *m += <span class="number">10</span>;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">"We added 10. `mut_value`: &#123;:?&#125;"</span>, m);</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-5-1-4-structs-结构体"><a href="#7-5-1-4-structs-结构体" class="headerlink" title="7.5.1.4 structs 结构体"></a>7.5.1.4 structs 结构体</h4><p>类似的，一个 struct 结构体可使用下面的方法进行解构。<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Foo</span></span> &#123; x: (<span class="keyword">u32</span>, <span class="keyword">u32</span>), y: <span class="keyword">u32</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将结构体成员解构</span></span><br><span class="line">    <span class="keyword">let</span> foo = Foo &#123; x: (<span class="number">1</span>, <span class="number">2</span>), y: <span class="number">3</span> &#125;;</span><br><span class="line">    <span class="keyword">let</span> Foo &#123; x: (a, b), y &#125; = foo;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"a = &#123;&#125;, b = &#123;&#125;,  y = &#123;&#125; "</span>, a, b, y);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 你可以解构一个结构体同时对变量重命名,</span></span><br><span class="line">    <span class="comment">// 顺序不重要</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> Foo &#123; y: i, x: j &#125; = foo;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"i = &#123;:?&#125;, j = &#123;:?&#125;"</span>, i, j);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 也可以忽略部分变量:</span></span><br><span class="line">    <span class="keyword">let</span> Foo &#123; y, .. &#125; = foo;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"y = &#123;&#125;"</span>, y);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这句话会导致错误: 模式中缺少了成员 `x`</span></span><br><span class="line">    <span class="comment">// let Foo &#123; y &#125; = foo;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>详见：<a href="http://rustbyexample.com/structs.html" target="_blank" rel="external">Structs</a>, <a href="http://rustbyexample.com/borrow/ref.html" target="_blank" rel="external">ref 模式</a>。</p>
<h3 id="7-5-2-Guards-守卫"><a href="#7-5-2-Guards-守卫" class="headerlink" title="7.5.2 Guards 守卫"></a>7.5.2 Guards 守卫</h3><p><code>match</code>中可以添加守卫语句来过滤分支。<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> pair = (<span class="number">2</span>, -<span class="number">2</span>);</span><br><span class="line">    <span class="comment">// TODO ^ 尝试不同的 `pair` 值</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"Tell me about &#123;:?&#125;"</span>, pair);</span><br><span class="line">    <span class="keyword">match</span> pair &#123;</span><br><span class="line">        (x, y) <span class="keyword">if</span> x == y =&gt; <span class="built_in">println!</span>(<span class="string">"These are twins"</span>),</span><br><span class="line">        <span class="comment">//     ^ 这里的 `if` 部分就是 *守卫* </span></span><br><span class="line">        (x, y) <span class="keyword">if</span> x + y == <span class="number">0</span> =&gt; <span class="built_in">println!</span>(<span class="string">"Antimatter, kaboom!"</span>),</span><br><span class="line">        (x, _) <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">1</span> =&gt; <span class="built_in">println!</span>(<span class="string">"The first one is odd"</span>),</span><br><span class="line">        _ =&gt; <span class="built_in">println!</span>(<span class="string">"No correlation..."</span>),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>详见：<a href="http://rustbyexample.com/tuples.html" target="_blank" rel="external">Tuples</a>。</p>
<h3 id="7-5-3-绑定"><a href="#7-5-3-绑定" class="headerlink" title="7.5.3 绑定"></a>7.5.3 绑定</h3><p>Rust 支持通过<code>match</code>来绑定变量：<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> age = <span class="number">3</span>;</span><br><span class="line">    <span class="comment">// TODO ^ 尝试不同的 `pair` 值</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"Tell me type of person you are"</span>);</span><br><span class="line">    <span class="keyword">match</span> age &#123;</span><br><span class="line">        <span class="comment">// 若为 1 到 12，则绑定到 `n`</span></span><br><span class="line">        n @ <span class="number">1</span>  ... <span class="number">12</span> =&gt; <span class="built_in">println!</span>(<span class="string">"I'm a child of age &#123;:?&#125;"</span>, n),</span><br><span class="line">        n @ <span class="number">13</span> ... <span class="number">19</span> =&gt; <span class="built_in">println!</span>(<span class="string">"I'm a teen of age &#123;:?&#125;"</span>, n),</span><br><span class="line">        <span class="comment">// 未能绑定，直接赋 age</span></span><br><span class="line">        n             =&gt; <span class="built_in">println!</span>(<span class="string">"I'm an old person of age &#123;:?&#125;"</span>, n),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="7-6-if-let"><a href="#7-6-if-let" class="headerlink" title="7.6 if let"></a>7.6 if let</h2><p>有些情况下使用<code>match</code>并不合适，譬如：<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建类型为 `Option&lt;i32&gt;` 的变量 `optional` </span></span><br><span class="line"><span class="keyword">let</span> optional = <span class="literal">Some</span>(<span class="number">7</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">match</span> optional &#123;</span><br><span class="line">    <span class="literal">Some</span>(i) =&gt; &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"This is a really long string and `&#123;:?&#125;`"</span>, i);</span><br><span class="line">        <span class="comment">// ^ 仅仅为了从 option 解构得到 i 我们居然就要缩进两格！</span></span><br><span class="line">    &#125;,</span><br><span class="line">    _ =&gt; &#123;&#125;,</span><br><span class="line">    <span class="comment">// ^ 我们不能省这一行，因为 `match` 要考虑所有情况</span></span><br><span class="line">    <span class="comment">// 这不是浪费是什么？</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>相对而言<code>if let</code>就简洁很多，而且若匹配失败也能指定处理语句：<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="comment">// 皆为类型 `Option&lt;i32&gt;`</span></span><br><span class="line">    <span class="keyword">let</span> number   = <span class="literal">Some</span>(<span class="number">7</span>);</span><br><span class="line">    <span class="keyword">let</span> letter: <span class="built_in">Option</span>&lt;<span class="keyword">i32</span>&gt; = <span class="literal">None</span>;</span><br><span class="line">    <span class="keyword">let</span> emoticon: <span class="built_in">Option</span>&lt;<span class="keyword">i32</span>&gt; = <span class="literal">None</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// `if let` 可以读作 "如果能将 `number` 解构成为</span></span><br><span class="line">    <span class="comment">// `Some(i)`, 那么就执行语句块 (`&#123;&#125;`). 否则什么也不做.</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="literal">Some</span>(i) = number &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"Matched &#123;:?&#125;!"</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用 else 来处理失败分支:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="literal">Some</span>(i) = letter &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"Matched &#123;:?&#125;!"</span>, i);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 解构失败</span></span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"Didn't match a number. Let's go with a letter!"</span>);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 提供另一个失败条件.</span></span><br><span class="line">    <span class="keyword">let</span> i_like_letters = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="literal">Some</span>(i) = emoticon &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"Matched &#123;:?&#125;!"</span>, i);</span><br><span class="line">    <span class="comment">// 解构失败，可进一步检查这个条件来判断是否执行这条分支</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> i_like_letters &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"Didn't match a number. Let's go with a letter!"</span>);</span><br><span class="line">    <span class="comment">// 上面的条件返回 false，只能执行本默认分支了</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"I don't like letters. Let's go with an emoticon :)!"</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>详见：<a href="http://rustbyexample.com/enum.html" target="_blank" rel="external">enum</a>，<a href="http://rustbyexample.com/option.html" target="_blank" rel="external">Option</a> 和 <a href="https://github.com/rust-lang/rfcs/pull/160" target="_blank" rel="external">RFC</a>。</p>
<h2 id="7-7-while-let"><a href="#7-7-while-let" class="headerlink" title="7.7 while let"></a>7.7 while let</h2><p>与 <code>if let</code> 类似，<code>while let</code>也可以简化某些臃肿的<code>match</code>。譬如考虑如下语句：<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建类型为 `Option&lt;i32&gt;` 的变量 `optional` </span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut</span> optional = <span class="literal">Some</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重复此测试</span></span><br><span class="line"><span class="keyword">loop</span> &#123;</span><br><span class="line">    <span class="keyword">match</span> optional &#123;</span><br><span class="line">        <span class="comment">// 若 `optional` 成功被解构，则执行下面的语句</span></span><br><span class="line">        <span class="literal">Some</span>(i) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> i &gt; <span class="number">9</span> &#123;</span><br><span class="line">                <span class="built_in">println!</span>(<span class="string">"Greater than 9, quit!"</span>);</span><br><span class="line">                optional = <span class="literal">None</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">println!</span>(<span class="string">"`i` is `&#123;:?&#125;`. Try again."</span>, i);</span><br><span class="line">                optional = <span class="literal">Some</span>(i + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ^ 三格缩进!</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 解构失败则退出，即 `break`.</span></span><br><span class="line">        _ =&gt; &#123; <span class="keyword">break</span>; &#125;</span><br><span class="line">        <span class="comment">// ^ 这么写太长了</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>使用了<code>while let</code>，代码更漂亮：<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="comment">// 创建类型为 `Option&lt;i32&gt;` 的变量 `optional` </span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> optional = <span class="literal">Some</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这可以读作 "只要可以解构 `optional` 成为</span></span><br><span class="line">    <span class="comment">// `Some(i)`, 便不断执行语句块 (`&#123;&#125;`). 否则 `break`.</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> <span class="literal">Some</span>(i) = optional &#123;</span><br><span class="line">        <span class="keyword">if</span> i &gt; <span class="number">9</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">"Greater than 9, quit!"</span>);</span><br><span class="line">            optional = <span class="literal">None</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">"`i` is `&#123;:?&#125;`. Try again."</span>, i);</span><br><span class="line">            optional = <span class="literal">Some</span>(i + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ^ 缩进更少而且不需要显示写出失败处理语句</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ^ `if let` 可以搭配另外的 `else`/`else if`</span></span><br><span class="line">    <span class="comment">// 语句. `while let` 没有这些机制</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>详见：<a href="http://rustbyexample.com/enum.html" target="_blank" rel="external">enum</a>，<a href="http://rustbyexample.com/option.html" target="_blank" rel="external">Option</a> 和 <a href="https://github.com/rust-lang/rfcs/pull/160" target="_blank" rel="external">RFC</a>。</p>

  </div>
  <footer class="article-footer">
    
  <div class="cc">
    <a href="http://creativecommons.org/licenses/by-sa/4.0/deed.e" target="_blank" title="Attribution-ShareAlike">
      <img src="/images/cc/cc.png">
      
          <img src="/images/cc/by.png">
        
          <img src="/images/cc/sa.png">
      
      <span>
        This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License.
      </span>
    </a>
  </div>


    

  </footer>
</article>




<section id="comments">
  <div id="disqus_thread"></div>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'howyoung'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>




          <div class="main-footer">
  
    © 2016 How Young? - Powered by <a href="http://hexo.io" target="_blank">Hexo</a> - Theme <a href="https://github.com/YANG-H/hexo-theme-chan" target="_blank">Chan</a> <a href="https://github.com/denjones/hexo-theme-chan.git" target="_blank">[Original]</a>
  
</div>

      
        </div>
      
    </div>
  </div>
  <script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>

  <link rel="stylesheet" href="/PhotoSwipe/photoswipe.css">
  <link rel="stylesheet" href="/PhotoSwipe/default-skin/default-skin.css">

  <!-- Root element of PhotoSwipe. Must have class pswp. -->
  <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
             It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

      <!-- Container that holds slides.
                PhotoSwipe keeps only 3 of them in the DOM to save memory.
                Don't modify these 3 pswp__item elements, data is added later on. -->
      <div class="pswp__container">
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
      </div>

      <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
      <div class="pswp__ui pswp__ui--hidden">

        <div class="pswp__top-bar">

          <!--  Controls are self-explanatory. Order can be changed. -->

          <div class="pswp__counter"></div>

          <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

          <button class="pswp__button pswp__button--share" title="Share"></button>

          <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

          <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

          <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
          <!-- element will get class pswp__preloader--active when preloader is running -->
          <div class="pswp__preloader">
            <div class="pswp__preloader__icn">
              <div class="pswp__preloader__cut">
                <div class="pswp__preloader__donut"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
          <div class="pswp__share-tooltip"></div>
        </div>

        <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>

        <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>

        <div class="pswp__caption">
          <div class="pswp__caption__center"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="/PhotoSwipe/photoswipe.js"></script>
  <script src="/PhotoSwipe/photoswipe-ui-default.js"></script>


<script src="/scripts/main.js"></script>

</body>
</html>
